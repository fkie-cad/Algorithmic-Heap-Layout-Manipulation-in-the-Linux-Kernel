# Example Vulnerability

This folder contains an exemplary vulnerable kernel module that contains a heap buffer overflow vulnerability. Its behaviour is quite simple: It can be queried to allocate a buffer and to write/print data to/from said buffer. Before and after the buffer gets allocated noise allocations will be made to make exploitation non-trivial. In addition, to aid exploitation, it can also be used to simulate the allocation of a target object that contains a function pointer. The invocation of said function pointer can be triggered. To use the module, follow the steps described in [RUNNING_KEVOHEAP.md](https://github.com/fkie-cad/Algorithmic-Heap-Layout-Manipulation-in-the-Linux-Kernel/blob/main/RUNNING_KEVOHEAP.md) to setup a suitable virtual machine with QEMU and load the module with `insmod`. Example exploits can be found under [exploits](https://github.com/fkie-cad/Algorithmic-Heap-Layout-Manipulation-in-the-Linux-Kernel/tree/main/exploit). 

## Building and Loading

Building the exemplary vulnerable kernel module and copy it to the running QEMU-VM:

```bash
$ make clean
...
$ make
...
$ cd ..
$ ./scp_to_qemu.sh vuln/vuln.ko
```

Ensure that you already run `setup.sh` from the first step as described in [RUNNING_KEVOHEAP.md](https://github.com/fkie-cad/Algorithmic-Heap-Layout-Manipulation-in-the-Linux-Kernel/blob/main/RUNNING_KEVOHEAP.md). This `make`-file expects in the folder above a directory `kernel_src` which is generated by `setup.sh`.

Next we connect to the running QEMU-VM via SSH and than load it:
```bash
$ ./ssh.sh
root@syzkaller:~# insmod vuln.ko
```

